This is where the logic resides